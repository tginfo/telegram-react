(this.webpackJsonptelegram_react=this.webpackJsonptelegram_react||[]).push([[4],{618:function(e,t,s){},620:function(e,t,s){},621:function(e,t,s){},622:function(e,t,s){},624:function(e,t,s){"use strict";s.r(t);var n=s(6),i=s.n(n),r=s(13),a=s(0),o=s.n(a),c=s(16),l=s.n(c),h=s(24),d=s(131),p=s.n(d),u=s(10),k=s(274),m=s(492),f=s(224),S=s(623),w=s(160),E=s(33),b=s(619),g=s.n(b),v=s(68),C=s(4);s(618);class P extends o.a.Component{shouldComponentUpdate(e,t,s){const n=this.props,i=n.info;return n.theme!==e.theme||i!==e.info}render(){const e=this.props,t=e.info,s=e.onSelect,n=e.onMouseDown,i=e.onMouseEnter,r=e.onDeleteClick;if(!t)return null;const a=t.title,c=t.stickers.map((e,t)=>o.a.createElement("div",{className:"sticker-set-item",key:e.sticker.id,"data-sticker-id":e.sticker.id,onClick:()=>s(e),onMouseEnter:i,onMouseDown:n,style:{width:C.mb,height:C.mb}},o.a.createElement(v.b,{key:e.sticker.id,sticker:e,autoplay:!1,blur:!1,displaySize:C.mb-6,preview:!0,source:v.a.PICKER})));return o.a.createElement("div",{className:"sticker-set"},o.a.createElement("div",{className:"sticker-set-title"},o.a.createElement("div",{className:"sticker-set-title-wrapper"},o.a.createElement("span",null,a)),r&&o.a.createElement(m.a,{"aria-label":"delete",classes:{root:"sticker-set-icon-root"},size:"small",onClick:r},o.a.createElement(g.a,{fontSize:"inherit"}))),o.a.createElement("div",{className:"sticker-set-content"},c))}}var M=P;class y{constructor(e,t=[]){this.start=()=>{this.stopped=!1,this.id=requestAnimationFrame(this.startAnim)},this.startAnim=e=>{const t=this.start,s=this.duration;this.start=e,this.end=t+s,this.draw(e)},this.draw=e=>{const t=this.stopped,s=this.duration,n=this.start,i=this.options;if(e-n>s&&i.every(e=>e.to===e.last)&&(this.stopped=!0),t)return;const r=Math.min(e-n,s),a=0===s?1:r/s,o=y.outSine(a);i.forEach(e=>{const t=e.from,s=e.to,n=e.func;e.last=t+(s-t)*o,n(e.last)}),this.id=requestAnimationFrame(this.draw)},this.stop=()=>{this.stopped=!0,cancelAnimationFrame(this.id)},this.options=t,this.duration=e}static outSine(e){return Math.sin(e*Math.PI/2)}}var R=y,j=s(48);s(620);class x extends o.a.Component{constructor(e){super(e),this.onClientUpdateStickerSetPosition=e=>{const t=e.position;this.setState({position:t})},this.scrollToPosition=()=>{const e=this.state.position,t=this.animator,s=this.anchorRef,n=this.scrollRef.current,i=s.current,r=E.findDOMNode(i),a=n.scrollLeft,o=44*e-147,c=Number(r.style.left.replace("px","")),l=44*e;t&&t.stop(),this.animator=new R(0,[{from:a,to:o,func:e=>n.scrollLeft=e},{from:Math.abs(l-c)>338?l-338*Math.sign(l-c):c,to:l,func:e=>r.style.left=e+"px"}]),setTimeout(()=>{this.animator&&this.animator.start()},0)},this.handleWheel=e=>{const t=this.scrollRef;if(0===e.deltaX){t.current.scrollLeft+=e.deltaY}},this.handleSelect=e=>{const t=this.props,s=t.stickers;(0,t.onSelect)(s.indexOf(e))},this.scrollRef=o.a.createRef(),this.anchorRef=o.a.createRef(),this.state={position:0}}componentDidMount(){j.a.on("clientUpdateStickerSetPosition",this.onClientUpdateStickerSetPosition)}componentWillUnmount(){j.a.off("clientUpdateStickerSetPosition",this.onClientUpdateStickerSetPosition)}componentDidUpdate(e,t,s){t.position!==this.state.position&&this.scrollToPosition()}render(){const e=this.props.stickers.map(e=>o.a.createElement(v.b,{key:e.sticker.id,className:"stickers-picker-header-sticker",style:{width:32,height:32},sticker:e,play:!1,autoplay:!1,blur:!1,displaySize:32,preview:!0,source:v.a.PICKER_HEADER,openMedia:()=>this.handleSelect(e)}));return o.a.createElement("div",{className:"stickers-picker-header"},o.a.createElement("div",{ref:this.scrollRef,className:"stickers-picker-header-scroll",onWheel:this.handleWheel},o.a.createElement("div",{className:"stickers-picker-header-items"},e),o.a.createElement("div",{ref:this.anchorRef,className:"stickers-picker-header-anchor"})))}}var O=x,U=s(19),D=s(14),T=s(37),I=s(2),N=s(1);s(621);class L extends o.a.Component{constructor(e){var t;super(e),t=this,this.onUpdateInstalledStickerSets=e=>{const t=e.is_masks;e.sticker_set_ids;t&&this.filterSets()},this.onUpdateRecentStickers=e=>{this.reloadRecentContent()},this.scrollTop=()=>{this.scrollRef.current.scrollTop=0},this.loadContent=function(){var e=Object(r.a)(i.a.mark((function e(s,n,r){var a,o,c,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=4;break}return e.next=3,N.a.send({"@type":"getRecentStickers",is_attached:!1});case 3:s=e.sent;case 4:if(r){e.next=13;break}return e.next=7,N.a.send({"@type":"getInstalledStickerSets",is_masks:!1});case 7:return a=e.sent,o=[],a.sets.forEach(e=>{o.push(N.a.send({"@type":"getStickerSet",set_id:e.id}))}),e.next=12,Promise.all(o);case 12:r=e.sent;case 13:c=r.slice(0,5),l=r.reduce((e,t)=>(t.stickers.length>0&&e.push(t.stickers[0]),e),[]),t.setState({recent:s,stickerSets:n,sets:c,fullSets:r,headerStickers:l}),t.setsLength=c.length;case 17:case"end":return e.stop()}}),e)})));return function(t,s,n){return e.apply(this,arguments)}}(),this.loadInViewContentOnScroll=()=>{this.loadInViewContent()},this.loadInViewContentOnScrollEnd=()=>{this.loadInViewContent(400)},this.loadInViewContent=(e=0)=>{const t=this.scrollRef.current,s=this.state.sets,n=[];s.forEach(s=>{const i=this.itemsMap.get(s.id),r=E.findDOMNode(i);if(r){const i=t.scrollTop-e,a=t.scrollTop+t.offsetHeight+e,o=r.offsetTop,c=r.offsetTop+r.clientHeight;(o>=i&&r.offsetTop<=a||c>=i&&c<=a||o<=i&&c>=a)&&n.push(s)}}),n.forEach(e=>{const t=I.a.getStore();this.loadedSets.has(e.id)||(this.loadedSets.set(e.id,e.id),Object(D.x)(t,e))})},this.updatePosition=()=>{const e=this.scrollRef.current,t=this.state.sets;let s=e.scrollHeight,n=0,i=0;t.forEach((t,r)=>{const a=this.itemsMap.get(t.id);if(a){const t=E.findDOMNode(a);if(t){i=0===r?t.offsetTop:i;const a=t.offsetTop-i;if(t&&a<=e.scrollTop){const t=Math.abs(e.scrollTop-a);t<=s&&(s=t,n=r)}}}}),N.a.clientUpdate({"@type":"clientUpdateStickerSetPosition",position:n})},this.handleScroll=Object(r.a)(i.a.mark((function e(){var s,n,r,a,o,c,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.loadInViewContentOnScrollEnd(),t.updatePosition(),s=t.scrollRef.current,!t.loadingChunk){e.next=5;break}return e.abrupt("return");case 5:if(n=!1,s.scrollTop+s.offsetHeight>=s.scrollHeight-400&&(n=!0),n){e.next=9;break}return e.abrupt("return",!1);case 9:if(r=t.state,a=r.sets,(o=r.stickerSets).sets.length!==a.length){e.next=12;break}return e.abrupt("return");case 12:return t.loadingChunk=!0,c=[],o.sets.slice(t.setsLength,t.setsLength+5).forEach(e=>{c.push(N.a.send({"@type":"getStickerSet",set_id:e.id}))}),e.next=17,Promise.all(c).finally(()=>{t.loadingChunk=!1});case 17:l=e.sent,t.setsLength+=l.length,t.setState({sets:a.concat(l)});case 20:case"end":return e.stop()}}),e)}))),this.loadPreviewContent=e=>{const t=this.state,s=t.recent,n=t.sets,i=Object(T.g)([s].concat(n)).find(t=>t.sticker.id===e);if(!i)return;const r=I.a.getStore();Object(D.w)(r,i,null);Object(T.f)(i,n,5).forEach(e=>{Object(D.w)(r,e,null)})},this.handleMouseEnter=e=>{const t=Number(e.currentTarget.dataset.stickerId);if(!t)return;if(!this.mouseDown)return;this.mouseDownStickerId!==t&&(this.mouseDownStickerId=null),this.setState({previewStickerId:t}),this.loadPreviewContent(t);const s=this.props.onPreview,n=this.state,i=n.recent,r=n.sets;s(Object(T.g)([i].concat(r)).find(e=>e.sticker.id===t))},this.handleMouseDown=e=>{const t=Number(e.currentTarget.dataset.stickerId);if(!t)return;this.mouseDownStickerId=t;const s=Date.now();return this.setState({previewStickerId:t,timestamp:s,showPreview:!1,cancelSend:!1}),setTimeout(()=>{this.state.timestamp===s&&this.setState({showPreview:!0,cancelSend:!0},()=>{const e=this.props.onPreview,s=this.state,n=s.recent,i=s.sets;e(Object(T.g)([n].concat(i)).find(e=>e.sticker.id===t))})},500),this.loadPreviewContent(t),this.mouseDown=!0,document.addEventListener("mouseup",this.handleMouseUp),e.preventDefault(),e.stopPropagation(),!1},this.handleMouseUp=()=>{this.setState({previewStickerId:0,timestamp:0,showPreview:!1}),(0,this.props.onPreview)(null),this.mouseDown=!1,document.removeEventListener("mouseup",this.handleMouseUp)},this.handleStickerSelect=e=>{const t=this.props.onSelect;this.state.cancelSend||t(e)},this.handleSelectSet=function(){var e=Object(r.a)(i.a.mark((function e(s){var n,r,a,o,c,l,h,d,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.state,r=n.sets,a=n.stickerSets,o=t.scrollRef,!(s<r.length)){e.next=7;break}(c=t.itemsMap.get(r[s].id))&&(l=E.findDOMNode(c))&&(o.current.scrollTop=l.offsetTop),e.next=21;break;case 7:if(!(s<a.sets.length)){e.next=21;break}if(!t.loadingChunk){e.next=10;break}return e.abrupt("return");case 10:if(a.sets.length!==r.length){e.next=12;break}return e.abrupt("return");case 12:return t.loadingChunk=!0,h=[],a.sets.slice(t.setsLength,s+1).forEach(e=>{h.push(N.a.send({"@type":"getStickerSet",set_id:e.id}))}),e.next=17,Promise.all(h).finally(()=>t.loadingChunk=!1);case 17:d=e.sent,t.setsLength+=d.length,p=r.concat(d),t.setState({sets:p},()=>{s<p.length&&t.handleSelectSet(s)});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleDeleteRecent=()=>{N.a.send({"@type":"clearRecentStickers",is_attached:!1})},this.handleDeleteStickerSet=e=>{N.a.send({"@type":"changeStickerSet",set_id:e,is_installed:!1})},this.scrollRef=o.a.createRef(),this.itemsMap=new Map,this.loadedSets=new Map,this.state={recent:null,stickerSets:null,sets:[],headerStickers:[],position:0},this.loadInViewContentOnScrollEnd=Object(U.c)(this.loadInViewContentOnScrollEnd,100),this.loadInViewContentOnScroll=Object(U.x)(this.loadInViewContentOnScroll,2e3),this.updatePosition=Object(U.x)(this.updatePosition,250)}shouldComponentUpdate(e,t,s){const n=this.state,i=n.position,r=n.recent,a=n.stickerSets,o=n.sets,c=n.showPreview;return t.recent!==r||(t.stickerSets!==a||(t.sets!==o||(t.showPreview!==c||t.position!==i)))}componentDidMount(){j.a.on("updateInstalledStickerSets",this.onUpdateInstalledStickerSets),j.a.on("updateRecentStickers",this.onUpdateRecentStickers)}componentWillUnmount(){j.a.off("updateInstalledStickerSets",this.onUpdateInstalledStickerSets),j.a.off("updateRecentStickers",this.onUpdateRecentStickers)}filterSets(e){const t=this.state;t.sets,t.stickerSets}reloadRecentContent(){var e=this;return Object(r.a)(i.a.mark((function t(){var s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N.a.send({"@type":"getRecentStickers",is_attached:!1});case 2:s=t.sent,e.setState({recent:s});case 4:case"end":return t.stop()}}),t)})))()}render(){const e=this.props.t,t=this.state,s=t.recent,n=(t.stickerSets,t.sets),i=t.headerStickers;this.itemsMap.clear();const r=n.map(e=>o.a.createElement(M,{key:e.id,ref:t=>this.itemsMap.set(e.id,t),info:e,onSelect:this.handleStickerSelect,onMouseDown:this.handleMouseDown,onMouseEnter:this.handleMouseEnter})),a=s&&s.stickers.length>0?{stickers:s.stickers,title:e("RecentStickers")}:null;return o.a.createElement("div",{className:"stickers-picker"},o.a.createElement(O,{onSelect:this.handleSelectSet,stickers:i}),o.a.createElement("div",{ref:this.scrollRef,className:"stickers-picker-scroll",onScroll:this.handleScroll},Boolean(a)&&o.a.createElement(M,{info:a,onSelect:this.handleStickerSelect,onMouseDown:this.handleMouseDown,onMouseEnter:this.handleMouseEnter,onDeleteClick:this.handleDeleteRecent}),r))}}var _=Object(h.a)(Object(h.d)(),Object(u.c)(),Object(h.c)())(L),V=s(7),A=s(92);s(622);class F extends o.a.Component{constructor(e){var t;super(e),t=this,this.onClientUpdateChange=e=>{this.picker=null},this.handleButtonMouseEnter=e=>{this.buttonEnter=!0,setTimeout(()=>{this.buttonEnter&&(this.updatePicker(!0),this.loadStickerSets())},C.f)},this.loadStickerSets=Object(r.a)(i.a.mark((function e(){var s,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.sets){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,N.a.send({"@type":"getRecentStickers",is_attached:!1});case 4:return t.recent=e.sent,e.next=7,N.a.send({"@type":"getInstalledStickerSets",is_masks:!1});case 7:return t.stickerSets=e.sent,s=[],t.stickerSets.sets.forEach(e=>{s.push(N.a.send({"@type":"getStickerSet",set_id:e.id}))}),e.next=12,Promise.all(s);case 12:t.sets=e.sent,n=t.stickersPickerRef.current,r=I.a.getStore(),Object(D.v)(r,t.recent),t.sets.slice(0,5).reverse().forEach(e=>{Object(D.x)(r,e),n.loadedSets.set(e.id,e.id)}),t.sets.reduce((e,t)=>(t.stickers.length>0&&e.push(t.stickers[0]),e),[]).forEach(e=>{Object(D.y)(r,e)});case 20:case"end":return e.stop()}}),e)}))),this.handleButtonMouseLeave=()=>{this.buttonEnter=!1,setTimeout(()=>{this.tryClosePicker()},C.f)},this.tryClosePicker=()=>{const e=this.state.sticker;this.paperEnter||this.buttonEnter||e||this.updatePicker(!1)},this.handlePaperMouseEnter=()=>{this.paperEnter=!0},this.handlePaperMouseLeave=()=>{this.paperEnter=!1,setTimeout(()=>{this.tryClosePicker()},C.f)},this.updatePicker=e=>{this.setState({open:e})},this.handleEmojiClick=()=>{this.setState({tab:0})},this.handleStickersClick=()=>{const e=this.stickersPickerRef.current,t=this.state.tab;e.loadContent(this.recent,this.stickerSets,this.sets),this.setState({tab:1}),1===t&&e.scrollTop()},this.handleStickerSend=e=>{e&&(N.a.clientUpdate({"@type":"clientUpdateStickerSend",sticker:e}),this.updatePicker(!1))},this.handleStickerPreview=e=>{this.setState({sticker:e}),N.a.clientUpdate({"@type":"clientUpdateStickerPreview",sticker:e}),e||this.tryClosePicker()},this.state={open:!1,tab:0},this.emojiPickerRef=o.a.createRef(),this.stickersPickerRef=o.a.createRef()}componentDidMount(){V.a.on("clientUpdateThemeChange",this.onClientUpdateChange),A.a.on("clientUpdateLanguageChange",this.onClientUpdateChange)}componentWillUnmount(){V.a.off("clientUpdateThemeChange",this.onClientUpdateChange),A.a.off("clientUpdateLanguageChange",this.onClientUpdateChange)}render(){const e=this.props,t=e.theme,s=e.t,n=this.state,i=n.open,r=n.tab,a=n.sticker;if(i&&!this.picker){const e={search:s("Search"),notfound:s("NotEmojiFound"),skintext:s("ChooseDefaultSkinTone"),categories:{search:s("SearchResults"),recent:s("Recent"),people:s("SmileysPeople"),nature:s("AnimalsNature"),foods:s("FoodDrink"),activity:s("Activity"),places:s("TravelPlaces"),objects:s("Objects"),symbols:s("Symbols"),flags:s("Flags"),custom:s("Custom")}};this.picker=o.a.createElement(S.a,{ref:this.emojiPickerRef,set:"apple",showPreview:!1,showSkinTones:!1,onSelect:this.props.onSelect,color:t.palette.primary.dark,i18n:e,native:Object(U.o)(),style:{width:338,overflowX:"hidden"}}),this.stickersPicker=o.a.createElement(_,{ref:this.stickersPickerRef,onSelect:this.handleStickerSend,onPreview:this.handleStickerPreview})}return o.a.createElement(o.a.Fragment,null,o.a.createElement("link",{rel:"stylesheet",type:"text/css",href:"dark"===t.palette.type?"emoji-mart.dark.css":"emoji-mart.light.css"}),o.a.createElement(m.a,{className:"inputbox-icon-button","aria-label":"Emoticon",onMouseEnter:this.handleButtonMouseEnter,onMouseLeave:this.handleButtonMouseLeave},o.a.createElement(f.a,null)),o.a.createElement("div",{className:l()("emoji-picker-root",{"emoji-picker-root-opened":i}),onMouseEnter:this.handlePaperMouseEnter,onMouseLeave:this.handlePaperMouseLeave},o.a.createElement("div",{className:"emoji-picker-header"},o.a.createElement(k.a,{color:0===r?"primary":"default",className:"emoji-picker-header-button",onClick:this.handleEmojiClick},s("Emoji")),o.a.createElement(k.a,{color:1===r?"primary":"default",className:"emoji-picker-header-button",onClick:this.handleStickersClick},s("Stickers"))),o.a.createElement("div",{className:l()("emoji-picker-content",{"emoji-picker-content-stickers":1===r})},this.picker,this.stickersPicker),Boolean(a)&&o.a.createElement(w.a,{sticker:a})))}}const B=Object(h.a)(Object(u.c)(),p.a);t.default=B(F)}}]);
//# sourceMappingURL=4.f73c76fd.chunk.js.map